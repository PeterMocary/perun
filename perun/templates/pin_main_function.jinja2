int main(int argc, char* argv[]) {
    // Initialize symbol table code, needed for routine instrumentation
    PIN_InitSymbols();

    //Initialize mutex locks for the shared output files and open these files
    PIN_MutexInit(&dynamicDataLock);
    dynamicData.open(DYNAMIC_DATA_FILE);
    {% if mode in ['time', 'instructions'] -%}
    PIN_MutexInit(&staticDataLock);
    staticData.open(STATIC_DATA_FILE);
    {%- endif %}

    // Initialize pin
    if (PIN_Init(argc, argv)) { return 1; }

    {% if collect_functions -%}
    // Register a function to be called when new image is loaded. The function will instrument it.
    IMG_AddInstrumentFunction(instrument{% if mode == 'memory' %}Memory{% endif %}RoutinesInImage, 0);
    {%- endif -%}

    {% if collect_basic_blocks -%}
    // Register a function to be called when new trace is about to be entered. The function will instrument it.
    TRACE_AddInstrumentFunction(instrumentBasicBlocksInTrace, 0);
    {%- endif -%}

    // Register Fini to be called when the application exits
    PIN_AddFiniFunction(fini, 0);

    // Start the program, never returns
    {% if probed -%}
    PIN_StartProgramProbed();
    {% else -%}
    PIN_StartProgram();
    {%- endif %}
    return 0;
}
